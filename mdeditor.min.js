/*! MarkdownEditor.js v0.3.2 | David.Wei <weiguangchun@gmail.com> */
$.fn.extend({insertAtCursor:function(a){var b=$(this)[0],c=b.selectionStart,d=b.selectionEnd,e=window.getSelection().toString();return e=a+e.replace(/\n/g,"\n"+a),b.value=b.value.substring(0,c)+e+b.value.substring(d),b.setSelectionRange(c+a.length,c+e.length),this.focus(),this},moveCursor:function(a){var b=$(this)[0],c=b.selectionStart,d=c+a;return b.setSelectionRange(d,d),this}}),$.event.special.valuechange={teardown:function(){$(this).unbind(".valuechange")},handler:function(){$.event.special.valuechange.triggerChanged($(this))},add:function(a){$(this).on("keyup.valuechange cut.valuechange paste.valuechange input.valuechange",a.selector,$.event.special.valuechange.handler)},triggerChanged:function(a){var b="true"===a[0].contentEditable?a.html():a.val(),c="undefined"==typeof a.data("previous")?a[0].defaultValue:a.data("previous");b!==c&&(a.trigger("valuechange",[a.data("previous")]),a.data("previous",b))}},function(){"use strict";var a,b;a=b=function(a){var d,e,f,g,c=this;a=$(a),d=a.find(".preview"),e=a.find("textarea"),f=a.find(".toolbar a"),g=a.find(".tips span");const h=["将图片文件直接拖动到编辑区域即可上传","使用英文#井号，引用指定id的问题，比如#123"];return c.bindEvents=function(){e.on({keydown:function(a){9==a.keyCode?(a.preventDefault(),$(this).insertAtCursor("    ")):27==a.keyCode&&($("body").removeClass("fullscreen-mode"),c.toggleFullscreenText())},valuechange:function(){var b=$(this).val(),c=marked(b);marked.setOptions({gfm:!0,breaks:!0,highlight:function(a){return hljs.highlightAuto(a).value}}),d.html(c)}}),f.click(function(){var a=$(this);a.hasClass("fa-link")?e.insertAtCursor("[](http://)").moveCursor(-10):a.hasClass("fa-table")?e.insertAtCursor("\n|A|B|C|\n|:-|:-:|-:|\n|1|2|3|\n").moveCursor(-26):a.hasClass("fa-columns")?$(".dw-markdown").addClass("sidebyside-mode"):a.hasClass("fa-file-o")?$(".dw-markdown").removeClass("sidebyside-mode"):a.hasClass("fa-expand")&&($("body").toggleClass("fullscreen-mode"),c.toggleFullscreenText()),e.focus().trigger("valuechange")})},c.toggleFullscreenText=function(){$(".fa-expand").attr("data-original-title",$("body").hasClass("fullscreen-mode")?"缩小":"全屏")},c.init=function(){c.bindEvents(),g.html(h[Math.floor(Math.random()*h.length)])},c.getEditor=function(a,c){return new b(a,c)},c.init(),c},a=new a,"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:("undefined"!=typeof window?window:this).ME=a}();